function makeTable() {
    var colCount = document.getElementById('columns');
    var rowCount = document.getElementById('rows');
    var tableElement = document.getElementById('editableTable');
    var colNamesInput = document.getElementById('columnNames');
    var rowNamesInput = document.getElementById('rowNames');
    
    var numCols = parseInt(colCount.value) || 3;
    var numRows = parseInt(rowCount.value) || 3;
    var colText = colNamesInput.value;
    var rowText = rowNamesInput.value;
    
    tableElement.innerHTML = '';
    
    var columnTitles = [];
    if (colText) {
        var nameList = colText.split(',');
        for (var i = 0; i < nameList.length; i++) {
            columnTitles.push(nameList[i].trim());
        }
    }
    
    var rowTitles = [];
    if (rowText) {
        var nameList = rowText.split(',');
        for (var i = 0; i < nameList.length; i++) {
            rowTitles.push(nameList[i].trim());
        }
    }
    
    var headerRow = tableElement.insertRow();
    var cornerCell = document.createElement('th');
    cornerCell.textContent = '';
    headerRow.appendChild(cornerCell);
    
    for (var i = 0; i < numCols; i++) {
        var headerCell = document.createElement('th');
        headerCell.textContent = columnTitles[i] || 'Колонка ' + (i + 1);
        headerCell.contentEditable = true;
        headerCell.className = 'column-header';
        headerRow.appendChild(headerCell);
    }
    
    for (var i = 0; i < numRows; i++) {
        var tableRow = tableElement.insertRow();
        var rowTitleCell = tableRow.insertCell();
        rowTitleCell.textContent = rowTitles[i] || 'Строка ' + (i + 1);
        rowTitleCell.contentEditable = true;
        rowTitleCell.className = 'row-header';
        
        for (var j = 0; j < numCols; j++) {
            var dataCell = tableRow.insertCell();
            dataCell.contentEditable = true;
            dataCell.textContent = '';
            dataCell.className = 'data-cell';
        }
    }
}

function saveToExcel() {
    var tableElement = document.getElementById('editableTable');
    var titleInput = document.getElementById('tableTitle');
    var fileName = titleInput.value || 'Таблица';
    
    if (tableElement.rows.length === 0) {
        alert('Сначала создайте таблицу!');
        return;
    }
    
    var outputData = [];
    outputData.push([fileName]);
    outputData.push([]);
    
    for (var i = 0; i < tableElement.rows.length; i++) {
        var dataLine = [];
        var rowCells = tableElement.rows[i].cells;
        
        for (var j = 0; j < rowCells.length; j++) {
            var cellData = rowCells[j].textContent;
            cellData = cellData.replace(/"/g, '""');
            
            if (cellData.indexOf(',') >= 0  cellData.indexOf('\n') >= 0) {
                cellData = '"' + cellData + '"';
            }
            
            dataLine.push(cellData);
        }
        outputData.push(dataLine.join(','));
    }
    
    var csvOutput = outputData.join('\n');
    var fileBlob = new Blob([csvOutput], { type: 'text/csv;charset=utf-8;' });
    var downloadLink = document.createElement('a');
    var fileUrl = URL.createObjectURL(fileBlob);
    
    downloadLink.setAttribute('href', fileUrl);
    downloadLink.setAttribute('download', fileName + '.csv');
    
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
    
    alert('Файл сохранен!');
}

function resetTable() {
    if (confirm('Удалить таблицу?')) {
        document.getElementById('editableTable').innerHTML = '';
        document.getElementById('tableTitle').value = '';
        document.getElementById('columnNames').value = '';
        document.getElementById('rowNames').value = '';
        document.getElementById('columns').value = '3';
        document.getElementById('rows').value = '3';
    }
}
document.addEventListener('DOMContentLoaded', function() {
    makeTable();
    document.getElementById('createBtn').addEventListener('click', makeTable);
    document.getElementById('exportBtn').addEventListener('click', saveToExcel);
    document.getElementById('clearBtn').addEventListener('click', resetTable);
});
